input {
  file {
    path => "C:/dfir_copy/client_data/*/output/network_logs/fortigate/logs/txt/*.json"
    start_position => "beginning"
    sincedb_path => "NUL"
    codec => json          # ðŸ”‘ JSON per line
  }
}

filter {

  # -------------------------------
  # CLIENT NAME FROM PATH
  # -------------------------------
  grok {
    match => {
      "[log][file][path]" => "client_data/%{DATA:client}/output"
    }
  }

  mutate {
    lowercase => ["client"]
  }

  # -------------------------------
  # TIMESTAMP NORMALIZATION
  # -------------------------------
  if [date] and [time] {
    date {
      match => ["date time", "yyyy-MM-dd HH:mm:ss"]
      target => "@timestamp"
      timezone => "Asia/Kolkata"
    }
  } else if [eventtime] {
    # FortiGate eventtime is nanoseconds
    ruby {
      code => '
        event.set("@timestamp",
          Time.at(event.get("eventtime") / 1000000000.0)
        )
      '
    }
  }

  # -------------------------------
  # TYPE NORMALIZATION (OPTIONAL)
  # -------------------------------
  mutate {
    lowercase => ["type", "subtype", "action"]
  }

  # -------------------------------
  # CLEANUP
  # -------------------------------
  mutate {
    remove_field => [
      "message",
      "host",
      "agent",
      "ecs",
      "@version",
      "tags"
    ]
  }
}

output {

  stdout { codec => rubydebug }

  elasticsearch {
    hosts => ["https://13.233.58.209:9200"]
    user => "elastic"
    password => "wsQcbfozMJF2BEnljEAq"
    ssl_enabled => true
    ssl_verification_mode => "none"
    index => "firewall-%{client}-%{+YYYY.MM.dd}"
  }
}
